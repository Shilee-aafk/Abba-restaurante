<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleccionar Mesa - Restaurante ABBA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        function toggleTable(event) {
            event.preventDefault();
            const checkbox = event.target;
            const tableId = checkbox.dataset.id;
            fetch(`/home/toggle-table/${tableId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const tableDiv = checkbox.closest('.table-card');
                    const statusText = tableDiv.querySelector('.status-text');
                    const link = tableDiv.querySelector('a');
                    if (data.is_available) {
                        tableDiv.classList.remove('bg-red-100', 'border-red-500');
                        tableDiv.classList.add('bg-white', 'border-gray-200');
                        statusText.textContent = 'Disponible';
                        link.classList.remove('pointer-events-none');
                        checkbox.checked = true;
                    } else {
                        tableDiv.classList.remove('bg-white', 'border-gray-200');
                        tableDiv.classList.add('bg-red-100', 'border-red-500');
                        statusText.textContent = 'Ocupada';
                        link.classList.add('pointer-events-none');
                        checkbox.checked = false;
                    }
                } else {
                    alert('Error al cambiar estado de la mesa');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al cambiar estado de la mesa');
            });
        }
    </script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Seleccionar Mesa</h1>
            <form method="post" action="{% url 'logout' %}" class="inline">
                {% csrf_token %}
                <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Cerrar Sesi√≥n</button>
            </form>
        </div>
        <div class="d-flex flex-wrap gap-3 justify-content-center">
            {% for table in tables %}
            <div class="table-card border rounded p-3 shadow-sm position-relative col-12 col-sm-6 col-md-4" style="min-height: 150px; max-width: 250px; {% if table.is_available %}background-color: white; border-color: #dee2e6;{% else %}background-color: #f8d7da; border-color: #f5c6cb;{% endif %}">
                <div class="form-check form-switch position-absolute top-0 end-0 m-2">
                    <input class="form-check-input" type="checkbox" role="switch" id="switch{{ table.id }}" data-id="{{ table.id }}" {% if table.is_available %}checked{% endif %} onclick="toggleTable(event)">
                    <label class="form-check-label" for="switch{{ table.id }}"></label>
                </div>
                <a href="{% url 'menu' table.id %}" class="{% if not table.is_available %}pointer-events-none{% endif %} text-decoration-none">
                    <h2 class="h5 text-primary">Mesa {{ table.number }}</h2>
                    <p class="text-secondary mb-1">Capacidad: {{ table.capacity }}</p>
                    <p class="small text-muted status-text">{% if table.is_available %}Disponible{% else %}Ocupada{% endif %}</p>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
